CREATE DATABASE TownieDB;
USE TownieDB;

CREATE TABLE Townies (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    Name VARCHAR(100) NOT NULL,
    Profession VARCHAR(100) NOT NULL
);

//install mysql.data & entityframework

Imports System
Imports MySql.Data.MySqlClient
Imports System.Data

' Main form class (must be first for designer support)
Public Class Form1
    ' MySQL connection string - modify according to your MySQL setup
    Private connectionString As String = "Server=localhost;Database=TownieDB;Uid=root;Pwd=;"

    Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        ' Add sample data if table is empty
        AddSampleData()

        ' Load data into DataGridView
        LoadData()
    End Sub

    Private Sub AddSampleData()
        Try
            Using connection As New MySqlConnection(connectionString)
                connection.Open()

                ' Check if data already exists
                Dim checkQuery As String = "SELECT COUNT(*) FROM Townies"
                Using checkCommand As New MySqlCommand(checkQuery, connection)
                    Dim count As Integer = CInt(checkCommand.ExecuteScalar())

                    ' Only add sample data if table is empty
                    If count = 0 Then
                        Dim sampleData As String() = {
                            "('Carol', 'Mayor')",
                            "('Dess', 'Student')",
                            "('Kris', 'Student')",
                            "('Susie', 'Student')",
                            "('Noelle', 'Student')",
                            "('Rudy', 'Unemployed')",
                            "('Berdly', 'Librarian')",
                            "('Alphys', 'Teacher')",
                            "('Undyne', 'Police Chief')",
                            "('Asgore', 'Florist')",
                            "('Alvin', 'Priest')",
                            "('Toriel', 'Teacher')",
                            "('Asriel', 'Student')",
                            "('Gerson', 'Writer')",
                            "('Temmie', 'Temmie')"
                        }

                        For Each data As String In sampleData
                            Dim insertQuery As String = "INSERT INTO Townies (Name, Profession) VALUES " & data
                            Using command As New MySqlCommand(insertQuery, connection)
                                command.ExecuteNonQuery()
                            End Using
                        Next
                    End If
                End Using
            End Using
        Catch ex As Exception
            MessageBox.Show("Error adding sample data: " & ex.Message)
        End Try
    End Sub

    Private Sub LoadData()
        Try
            Using connection As New MySqlConnection(connectionString)
                connection.Open()

                Dim query As String = "SELECT Id, Name, Profession FROM Townies ORDER BY Name"
                Using adapter As New MySqlDataAdapter(query, connection)
                    Dim dataTable As New DataTable()
                    adapter.Fill(dataTable)
                    DataGridView1.DataSource = dataTable
                End Using
            End Using
        Catch ex As Exception
            MessageBox.Show("Error loading data: " & ex.Message)
        End Try
    End Sub

    Private Sub Insert_Click(sender As Object, e As EventArgs) Handles Insert.Click
        Dim name As String = TextBox1.Text.Trim()
        Dim profession As String = TextBox2.Text.Trim()

        If String.IsNullOrEmpty(name) Or String.IsNullOrEmpty(profession) Then
            MessageBox.Show("Please enter both name and profession.")
            Return
        End If

        Try
            Using connection As New MySqlConnection(connectionString)
                connection.Open()

                Dim query As String = "INSERT INTO Townies (Name, Profession) VALUES (@Name, @Profession)"
                Using command As New MySqlCommand(query, connection)
                    command.Parameters.AddWithValue("@Name", name)
                    command.Parameters.AddWithValue("@Profession", profession)
                    command.ExecuteNonQuery()
                End Using
            End Using

            ' Clear textboxes and refresh data
            TextBox1.Clear()
            TextBox2.Clear()
            LoadData()
            MessageBox.Show("Townie added successfully!")

        Catch ex As Exception
            MessageBox.Show("Error inserting data: " & ex.Message)
        End Try
    End Sub

    Private Sub Update_Click(sender As Object, e As EventArgs) Handles Update.Click
        If DataGridView1.CurrentRow Is Nothing Then
            MessageBox.Show("Please select a villager to update.")
            Return
        End If

        Dim name As String = TextBox1.Text.Trim()
        Dim profession As String = TextBox2.Text.Trim()

        If String.IsNullOrEmpty(name) Or String.IsNullOrEmpty(profession) Then
            MessageBox.Show("Please enter both name and profession.")
            Return
        End If

        Try
            Dim id As Integer = CInt(DataGridView1.CurrentRow.Cells("Id").Value)

            Using connection As New MySqlConnection(connectionString)
                connection.Open()

                Dim query As String = "UPDATE Townies SET Name = @Name, Profession = @Profession WHERE Id = @Id"
                Using command As New MySqlCommand(query, connection)
                    command.Parameters.AddWithValue("@Name", name)
                    command.Parameters.AddWithValue("@Profession", profession)
                    command.Parameters.AddWithValue("@Id", id)
                    command.ExecuteNonQuery()
                End Using
            End Using

            ' Clear textboxes and refresh data
            TextBox1.Clear()
            TextBox2.Clear()
            LoadData()
            MessageBox.Show("Townie updated successfully!")

        Catch ex As Exception
            MessageBox.Show("Error updating data: " & ex.Message)
        End Try
    End Sub

    Private Sub Delete_Click(sender As Object, e As EventArgs) Handles Delete.Click
        If DataGridView1.CurrentRow Is Nothing Then
            MessageBox.Show("Please select a villager to delete.")
            Return
        End If

        Dim result As DialogResult = MessageBox.Show("Are you sure you want to delete this townie?", "Confirm Delete", MessageBoxButtons.YesNo, MessageBoxIcon.Question)

        If result = DialogResult.Yes Then
            Try
                Dim id As Integer = CInt(DataGridView1.CurrentRow.Cells("Id").Value)

                Using connection As New MySqlConnection(connectionString)
                    connection.Open()

                    Dim query As String = "DELETE FROM Townies WHERE Id = @Id"
                    Using command As New MySqlCommand(query, connection)
                        command.Parameters.AddWithValue("@Id", id)
                        command.ExecuteNonQuery()
                    End Using
                End Using

                LoadData()
                MessageBox.Show("Townie deleted successfully!")

            Catch ex As Exception
                MessageBox.Show("Error deleting data: " & ex.Message)
            End Try
        End If
    End Sub

    Private Sub DataGridView1_SelectionChanged(sender As Object, e As EventArgs) Handles DataGridView1.SelectionChanged
        ' Auto-fill textboxes when a row is selected
        If DataGridView1.CurrentRow IsNot Nothing Then
            TextBox1.Text = DataGridView1.CurrentRow.Cells("Name").Value.ToString()
            TextBox2.Text = DataGridView1.CurrentRow.Cells("Profession").Value.ToString()
        End If
    End Sub
End Class

